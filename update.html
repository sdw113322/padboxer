<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>Puzzle & Dragons 素材管理程式</title>
	<link rel=stylesheet type="text/css" href="./css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="./css/tooltipster.css" />
	<script type="text/javascript" src="./js/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="./js/bootstrap.min.js"></script>
	<script type="text/javascript" src="./js/jquery.ba-throttle-debounce.min.js"></script>
    <style type="text/css"> 
	 .main{
        width: 100%;
        margin-left: auto;
        margin-right: auto;
        border-left: 5px;
        border-right: 5px;
        border-left-style: solid;
        border-right-style: solid;
        border-color: #FFFFFF;
        background-color: #FFFFFF;
        
      }
      .pageHeader{
        height: 200px;
      }
	  .body{
		padding: 30px;	  
	  }
	  .nav{
	    padding-bottom: 20px;
	  }
	  .nav-left{
		float: left;
	  }
	  .nav-right{
		float: right;
	  }
	  .footer{
		text-align:center;
	  }
	  #welcome h1{
		padding-top: 10%;
		padding-bottom: 10%;
	  }
	  #welcome h2{
		padding-bottom: 10%;
	  }
	  .wrapper{
		padding-left: 10%;
		padding-right: 10%;
	  }
	  p{
		font-size: 18px;
	  }
	</style>
	<script type="text/javascript">
	$(document).ready(function() {
		$("#step2").click(function(){
			$("#welcome").hide();
			$("#description").show();
			$("#btn-step1").parent().removeClass("active");
			$("#btn-step2").parent().addClass("active");
		});
		$("#step3").click(function(){
			$("#description").hide();
			$("#result").show();
			$("#btn-step2").parent().removeClass("active");
			$("#btn-step3").parent().addClass("active");
			var box = JSON.parse(window.localStorage.box);
			var evolution = JSON.parse(window.localStorage.evolution);
			var name = JSON.parse(window.localStorage.name);
			var evol = [];
			var unique = [];
			var remove = [];
			for(var i in box){
				if(evolution[box[i].no].status === "y")
					evol.push(i);
			}
			for(var j in evol){
				var same = -1;
				for(var k in unique){
					if(box[evol[j]].no == box[unique[k]].no)
						same = unique[k];
				}
				if(same != -1){
					if(typeof box[evol[j]].from == 'undefined'){
						if(typeof box[evol[j]].quantity != 'undefined')
							var qty = Number(box[evol[j]].quantity);
						else
							var qty = 1;
						if(typeof box[evol[j]].priortiy != 'undefined')
							var pqty = Number(box[evol[j]].priority);
						else
							var pqty = 0;
						if(typeof box[same].quantity == 'undefined')
							box[same].quantity = 1 + qty;
						else
							box[same].quantity = Number(qty) + Number(box[same].quantity);
						if(typeof box[same].priortiy == 'undefined')
							box[same].priority = pqty;
						else
							box[same].priority = Number(pqty) + Number(box[same].priority);
						remove.push(evol[j]);
					}
				}else{
					unique.push(evol[j]);
				}
			}
			var m = remove.length;
			for(var l in remove){
				box.splice(remove[m-l-1], 1);
			}
			$.each( box, function( key, value ) {
				$("tbody").append(
					$("<tr>")
						.append($("<td>").text(value.id))
						.append($("<td>").text(value.no + "(" + name[value.no].chinese + ")"))
						.append($("<td>").text(value.quantity))
						.append($("<td>").text(value.priority))
						.append(function(){
							if(typeof value.from != 'undefined')
								return $("<td>").text(value.from);
							else return $("<td>");
						})
						.append(function(){
							if(typeof value.choice != 'undefined')
								return $("<td>").text(value.choice + "(" + name[value.choice].chinese + ")");
							else return $("<td>");
						})
				);
			});
		});
		$("#submit").click(function(){
			var string = JSON.stringify(box);
			window.localStorage.box = string;
			location.href = "index.html";
		});
	});
	</script>
  </head>
  <body>
    <div class="main">
      <div class="body container-fluid">
	  <div class="nav">
	  <div class="nav-left">
	  <ul class="nav nav-pills">
		  <li class="active"><a id="btn-step1" style="font-size:18px;">歡迎</a></li>
		  <li><a id="btn-step2" style="font-size:18px;">說明</a></li>
		  <li><a id="btn-step3" style="font-size:18px;">結果</a></li>
	  </ul>
	  </div>
	  </div>
	  <div class="jumbotron" id="welcome">
		  <div class="container">
			 <h1>PAD 素材管理程式 更新程式 for v2.0</h1>
		  <h2>按下一步繼續</h2>
		  <p><a class="btn btn-primary btn-lg" href="#" role="button" id="step2">下一步</a></p>
		</div>
	</div>
	  <div id="description" style="display:none">
	  <div class="wrapper container-fluid">
	  <h1>說明</h1>
	  <p>本程式是用來將之前版本中重複的項目濃縮成一筆的工具</p>
	  <p>因為在v2.0中並沒有合併的功能，所以做出這個東西，方便日後使用</p>
	  <p>本程式只會對可以進化(不包含究極進化)的寵物進行合併</p>
	  <p>使用完後可以刪除這個檔案，不會對主程式有任何影響</p>
	  <br>
	  
	  <div class="alert alert-danger" role="alert"><p>這個程式對存檔做出的更動是不可逆的，請先備份保平安</p></div>
	  <div class="alert alert-info" role="alert"><p>在下一個"結果"分頁按下確認鈕合併才會生效</p></div>
	  <br>
	  <h2>按下一步繼續</h2>
		 <p><a class="btn btn-primary btn-lg" href="#" role="button" id="step3">下一步</a></p>
	  </div>
		</div>
		<div id="result" style="display:none" class="container-fluid">
			<div class="wrapper container-fluid">
			<h1>合併結果</h1>
			<table class="table">
			<thead><th>id</th><th>no</th><th>數量</th><th>優先數量</th><th>from</th><th>究進選擇</th></thead>
			<tbody></tbody>
			</table>
			<div class="alert alert-info" role="alert"><p>如果與您預期的結果不同，請聯絡原作者</p><p>按下確認鈕合併才會生效</p><p>按下確認鈕後會自動轉回主程式</p></div>
			<p><a class="btn btn-primary btn-lg" href="#" role="button" id="submit">確認</a></p>
			</div>
		</div>
      </div>
	  <div class="footer"> 
	  </div>
    </div>
  </body>
</html>
